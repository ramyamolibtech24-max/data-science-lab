import requests
import pandas as pd
import os
from datetime import datetime

def fetch_remoteok_jobs():
    url = "https://remoteok.com/api"
    headers = {"User-Agent": "Mozilla/5.0"}
    try:
        print("Fetching data from RemoteOK API...")
        response = requests.get(url, headers=headers)
        response.raise_for_status()  # Raises error for HTTP issues
        jobs = response.json()[1:]  # Skip metadata
        print(f"Success! Found {len(jobs)} jobs.")
        return jobs
    except Exception as e:
        print(f"API Error: {e}")
        return None

if __name__ == "__main__":
    jobs = fetch_remoteok_jobs()
    if jobs:
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"remoteok_jobs_{timestamp}.csv"
        
        # Debug: Print paths
        print(f"\nCurrent directory: {os.getcwd()}")
        print(f"CSV will be saved to: {os.path.abspath(filename)}\n")
        
        # Save CSV
        pd.DataFrame(jobs).to_csv(filename, index=False)
        print(f"✅ CSV saved to: {filename}")
    else:
        print("❌ No data to save. Check API/network.")
